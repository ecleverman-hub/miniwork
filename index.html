<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›¶å·¥æ‰“å¡è–ªèµ„è®¡ç®—å™¨</title>

    <!-- PWA ç›¸å…³ -->
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
            "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
        }

        body {
            background: radial-gradient(circle at top, #e0f2fe, #eef2f7);
            color: #111;
            line-height: 1.6;
            padding: 12px;
            font-size: 20px; /* æ•´ä½“å­—ä½“åå¤§ */
        }

        .container {
            max-width: 560px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.16);
            padding: 22px 18px 26px;
            border: 1px solid #e5e7eb;
        }

        h1 {
            text-align: center;
            margin-bottom: 6px;
            color: #0f172a;
            font-size: 30px;
            letter-spacing: 2px;
        }

        .sub-title {
            text-align: center;
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 14px;
        }

        .settings {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 12px;
            background-color: #f9fafb;
            padding: 14px 14px 12px;
            border-radius: 18px;
            border: 1px solid #e5e7eb;
        }

        .wage-input {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .wage-input label {
            font-weight: 700;
            font-size: 22px;
            white-space: nowrap;
        }

        .wage-input input {
            padding: 8px 10px;
            border: 1px solid #d1d5db;
            border-radius: 999px;
            width: 140px;
            font-size: 22px;
            text-align: center;
            background: #ffffff;
        }

        .current-time-label {
            font-size: 18px;
            color: #6b7280;
        }

        .current-time {
            font-size: 22px;
            font-weight: 700;
            color: #2563eb;
            margin-top: 4px;
            word-break: break-all;
        }

        /* é»„è‰²åŒºåŸŸï¼šæ‰‹åŠ¨è¾“å…¥ä¸Šä¸‹ç­æ—¶é—´ */
        .manual-input {
            margin: 14px 0;
            padding: 16px 14px 14px;
            background: #fff7ed;
            border-radius: 18px;
            border: 1px solid #fed7aa;
        }

        .manual-input-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 26px;
            color: #111827;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .manual-input-title::before {
            content: "ğŸ•’";
            font-size: 26px;
        }

        .manual-label {
            display: block;
            margin-top: 6px;
            margin-bottom: 4px;
            font-size: 22px;
            font-weight: 700;
            color: #111827;
        }

        .manual-input input[type="time"] {
            width: 100%;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            font-size: 24px;
            background-color: #ffffff;
        }

        .manual-input button {
            margin-top: 14px;
            width: 100%;
            padding: 14px;
            font-size: 24px;
            font-weight: 700;
            border-radius: 999px;
            border: none;
            background: linear-gradient(90deg, #2563eb, #4f46e5);
            color: #ffffff;
            cursor: pointer;
        }

        .manual-input button:active {
            transform: scale(0.97);
        }

        /* çº¢æ¡†ï¼šåªä¿ç•™â€œæ—¥ç»“â€æ ‡ç­¾ï¼ˆåšæˆä¸€ä¸ªèƒ¶å›Šï¼‰ */
        .view-switch {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .view-btn {
            padding: 8px 30px;
            font-size: 22px;
            border-radius: 999px;
            border: none;
            background-color: #2563eb;
            color: #ffffff;
            font-weight: 700;
            box-shadow: 0 2px 5px rgba(37, 99, 235, 0.4);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .stat-card {
            background-color: #f9fafb;
            padding: 12px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .stat-card h3 {
            margin-bottom: 6px;
            color: #374151;
            font-size: 22px;
        }

        .stat-value {
            font-size: 26px;
            font-weight: 700;
            color: #2563eb;
        }

        .highlight {
            color: #f97316;
        }

        .section-title {
            margin-bottom: 8px;
            color: #111827;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 4px;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-title span:last-child {
            font-size: 16px;
            color: #9ca3af;
        }

        .today-record {
            margin-bottom: 12px;
        }

        .record-list {
            max-height: 260px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            background-color: #ffffff;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 20px;
            gap: 8px;
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-time {
            font-weight: 700;
            color: #111827;
        }

        .record-duration {
            color: #6b7280;
            text-align: right;
            white-space: nowrap;
            margin-right: 6px;
        }

        .record-delete-btn {
            flex-shrink: 0;
            border: none;
            border-radius: 999px;
            padding: 4px 10px;
            font-size: 18px;
            background: #ef4444;
            color: #fff;
            cursor: pointer;
        }

        .record-delete-btn:active {
            transform: scale(0.96);
        }

        .record-empty {
            padding: 14px;
            text-align: center;
            color: #9ca3af;
            font-size: 20px;
        }

        /* æœ¬æœˆæ‰“å¡è®°å½•æ—¥æœŸå°æ ‡é¢˜ */
        .record-date-header {
            padding: 8px 12px;
            background: #f3f4ff;
            color: #4b5563;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb;
        }

        .monthly-stats {
            margin-top: 10px;
        }

        .month-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .month-summary .stat-card {
            padding: 10px 8px;
        }

        .export-wrap {
            margin-top: 12px;
            text-align: right;
        }

        .export-btn {
            padding: 10px 16px;
            border-radius: 999px;
            border: none;
            background-color: #10b981;
            color: #ffffff;
            font-size: 20px;
            cursor: pointer;
            font-weight: 700;
        }

        .export-btn:active {
            transform: scale(0.97);
        }

        .month-records {
            margin-top: 12px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 16px 12px 22px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .month-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>é›¶å·¥æ‰“å¡è–ªèµ„è®¡ç®—å™¨</h1>
    <div class="sub-title">ä¸‹ç­åè‡ªå·±å¡«ä¸Šç­ / ä¸‹ç­æ—¶é—´ï¼Œè‡ªåŠ¨ç®—å½“å¤©å·¥èµ„å’Œæœ¬æœˆå·¥èµ„ ğŸ’°</div>

    <div class="settings">
        <div class="wage-input">
            <label for="hourly-wage">æ—¶è–ªï¼ˆå…ƒ/å°æ—¶ï¼‰</label>
            <input type="number" id="hourly-wage" min="0" step="0.5" value="14">
        </div>
        <div>
            <div class="current-time-label">å½“å‰æ—¶é—´</div>
            <div class="current-time" id="current-time"></div>
        </div>
    </div>

    <!-- é»„è‰²åŒºåŸŸï¼šæ‰‹åŠ¨è¾“å…¥ -->
    <div class="manual-input">
        <div class="manual-input-title">æ‰‹åŠ¨è¾“å…¥ä»Šå¤©çš„ä¸Šç­ / ä¸‹ç­æ—¶é—´</div>

        <label class="manual-label" for="manual-start">ä¸Šç­æ—¶é—´</label>
        <input id="manual-start" type="time">

        <label class="manual-label" for="manual-end" style="margin-top: 8px;">ä¸‹ç­æ—¶é—´</label>
        <input id="manual-end" type="time">

        <button id="save-manual-record">ï¼‹ ä¿å­˜ä»Šå¤©è¿™æ®µä¸Šç­è®°å½•</button>
    </div>

    <!-- çº¢æ¡†ï¼šåªä¿ç•™â€œæ—¥ç»“â€æ ‡ç­¾ -->
    <div class="view-switch">
        <button class="view-btn" disabled>æ—¥ç»“</button>
    </div>

    <div class="stats">
        <div class="stat-card">
            <h3>ä»Šæ—¥å·¥ä½œæ—¶é•¿</h3>
            <div class="stat-value" id="today-duration">0 åˆ†é’Ÿ</div>
        </div>
        <div class="stat-card">
            <h3>ä»Šæ—¥æ”¶å…¥</h3>
            <div class="stat-value highlight" id="today-earnings">0 å…ƒ</div>
        </div>
    </div>

    <div class="today-record">
        <div class="section-title">
            <span>ä»Šæ—¥æ‰“å¡è®°å½•</span>
            <span>ä¸€æ¬¡ä¸Šç­ + ä¸€æ¬¡ä¸‹ç­ ä¸ºä¸€ç»„</span>
        </div>
        <div class="record-list" id="today-records"></div>
    </div>

    <div class="monthly-stats">
        <div class="section-title">
            <span>æœ¬æœˆç»Ÿè®¡</span>
        </div>
        <div class="month-summary">
            <div class="stat-card">
                <h3>å·¥ä½œå¤©æ•°</h3>
                <div class="stat-value" id="month-days">0 å¤©</div>
            </div>
            <div class="stat-card">
                <h3>æ€»æ—¶é•¿</h3>
                <div class="stat-value" id="month-duration">0 åˆ†é’Ÿ</div>
            </div>
            <div class="stat-card">
                <h3>æ€»æ”¶å…¥</h3>
                <div class="stat-value highlight" id="month-earnings">0 å…ƒ</div>
            </div>
        </div>

        <div class="export-wrap">
            <button class="export-btn" id="export-month-btn">å¯¼å‡ºæœ¬æœˆè®°å½•ä¸º Excel</button>
        </div>
    </div>

    <!-- æ–°å¢ï¼šæœ¬æœˆæ‰“å¡è®°å½•åˆ—è¡¨ -->
    <div class="month-records">
        <div class="section-title">
            <span>æœ¬æœˆæ‰“å¡è®°å½•</span>
            <span>æŒ‰æ—¥æœŸä»æ—©åˆ°æ™šæ’åˆ—</span>
        </div>
        <div class="record-list" id="month-records-list"></div>
    </div>
</div>

<!-- Excel å¯¼å‡ºåº“ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
    // ===== å…¨å±€æ•°æ® =====
    let workRecords = JSON.parse(localStorage.getItem('workRecords')) || {};
    let hourlyWage = parseFloat(localStorage.getItem('hourlyWage')) || 14;

    const currentTimeEl = document.getElementById('current-time');
    const hourlyWageInput = document.getElementById('hourly-wage');

    const todayDurationEl = document.getElementById('today-duration');
    const todayEarningsEl = document.getElementById('today-earnings');
    const todayRecordsEl = document.getElementById('today-records');

    const monthDaysEl = document.getElementById('month-days');
    const monthDurationEl = document.getElementById('month-duration');
    const monthEarningsEl = document.getElementById('month-earnings');
    const monthRecordsListEl = document.getElementById('month-records-list');

    const exportMonthBtn = document.getElementById('export-month-btn');

    const manualStartInput = document.getElementById('manual-start');
    const manualEndInput = document.getElementById('manual-end');
    const saveManualBtn = document.getElementById('save-manual-record');

    function getTodayKey() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth() + 1).padStart(2, '0');
        const d = String(now.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    function getMonthKey() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth() + 1).padStart(2, '0');
        return `${y}-${m}`;
    }

    function saveData() {
        localStorage.setItem('workRecords', JSON.stringify(workRecords));
        localStorage.setItem('hourlyWage', String(hourlyWage));
    }

    // æ˜¾ç¤ºå½“å‰æ—¶é—´
    function updateCurrentTime() {
        const now = new Date();
        currentTimeEl.textContent = now.toLocaleString('zh-CN');
    }
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);

    // æ—¶è–ªå˜åŒ–
    hourlyWageInput.value = hourlyWage;
    hourlyWageInput.addEventListener('change', () => {
        const v = parseFloat(hourlyWageInput.value);
        if (isNaN(v) || v < 0) {
            alert('æ—¶è–ªè¯·è¾“å…¥æ­£ç¡®çš„æ•°å­—');
            hourlyWageInput.value = hourlyWage;
            return;
        }
        hourlyWage = v;
        saveData();
        updateDisplay();
    });

    // æ‰‹åŠ¨ä¿å­˜ä¸€æ¡ä»Šå¤©çš„è®°å½•
    if (saveManualBtn) {
        saveManualBtn.addEventListener('click', () => {
            const startStr = manualStartInput.value;
            const endStr = manualEndInput.value;

            if (!startStr || !endStr) {
                alert('è¯·å…ˆé€‰æ‹©ä¸Šç­æ—¶é—´å’Œä¸‹ç­æ—¶é—´');
                return;
            }

            const [sh, sm] = startStr.split(':').map(Number);
            const [eh, em] = endStr.split(':').map(Number);

            const today = new Date();
            const startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), sh, sm, 0, 0);
            const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), eh, em, 0, 0);

            if (endDate <= startDate) {
                alert('ä¸‹ç­æ—¶é—´å¿…é¡»æ™šäºä¸Šç­æ—¶é—´');
                return;
            }

            const todayKey = getTodayKey();
            if (!workRecords[todayKey]) {
                workRecords[todayKey] = [];
            }

            workRecords[todayKey].push({
                start: startDate.getTime(),
                end: endDate.getTime()
            });

            saveData();
            updateDisplay();

            const minutes = Math.round((endDate - startDate) / (1000 * 60));
            alert(`å·²ä¿å­˜ï¼š${startStr} - ${endStr}\næœ¬æ¬¡çº¦ ${minutes} åˆ†é’Ÿ`);

            manualStartInput.value = '';
            manualEndInput.value = '';
        });
    }

    // åˆ é™¤æŸä¸€å¤©çš„æŸæ¡è®°å½•
    function deleteRecord(dateKey, index) {
        const list = workRecords[dateKey];
        if (!list || index < 0 || index >= list.length) return;

        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;

        list.splice(index, 1);
        if (list.length === 0) {
            delete workRecords[dateKey];
        }
        saveData();
        updateDisplay();
    }

    // ä»Šæ—¥æ±‡æ€»
    function updateSummaryView() {
        const todayKey = getTodayKey();
        const todayRecords = workRecords[todayKey] || [];
        let totalMinutes = 0;

        todayRecords.forEach(record => {
            if (record.end) {
                totalMinutes += Math.round((record.end - record.start) / (1000 * 60));
            }
        });

        const totalEarnings = ((totalMinutes / 60) * hourlyWage).toFixed(2);

        todayDurationEl.textContent = `${totalMinutes} åˆ†é’Ÿ`;
        todayEarningsEl.textContent = `${totalEarnings} å…ƒ`;
    }

    // ä»Šæ—¥è®°å½•åˆ—è¡¨
    function updateRecordList() {
        todayRecordsEl.innerHTML = '';

        function showEmpty(msg) {
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'record-empty';
            emptyDiv.textContent = msg;
            todayRecordsEl.appendChild(emptyDiv);
        }

        const todayKey = getTodayKey();
        const todayRecords = workRecords[todayKey] || [];

        if (todayRecords.length === 0) {
            showEmpty('ä»Šæ—¥æš‚æ— æ‰“å¡è®°å½•');
            return;
        }

        todayRecords.forEach((record, index) => {
            const recordItem = document.createElement('div');
            recordItem.className = 'record-item';

            const startTime = new Date(record.start);
            const startTimeStr = startTime.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit'
            });

            let mainHtml = '';
            if (record.end) {
                const endTime = new Date(record.end);
                const endTimeStr = endTime.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const duration = Math.round((record.end - record.start) / (1000 * 60));
                const earnings = ((duration / 60) * hourlyWage).toFixed(2);

                mainHtml = `
                    <div class="record-time">${startTimeStr} - ${endTimeStr}</div>
                    <div class="record-duration">${duration} åˆ†é’Ÿï¼ˆçº¦ ${earnings} å…ƒï¼‰</div>
                `;
            } else {
                mainHtml = `
                    <div class="record-time">${startTimeStr} - è¿›è¡Œä¸­â€¦</div>
                    <div class="record-duration">ç­‰å¾…ä¸‹ç­æ—¶é—´</div>
                `;
            }

            recordItem.innerHTML = mainHtml;

            const delBtn = document.createElement('button');
            delBtn.textContent = 'åˆ é™¤';
            delBtn.className = 'record-delete-btn';
            delBtn.addEventListener('click', () => deleteRecord(todayKey, index));

            recordItem.appendChild(delBtn);
            todayRecordsEl.appendChild(recordItem);
        });
    }

    // æœ¬æœˆç»Ÿè®¡
    function updateMonthStats() {
        const monthKey = getMonthKey();
        let monthWorkDays = 0;
        let monthTotalMinutes = 0;

        Object.keys(workRecords).forEach(dateKey => {
            if (dateKey.startsWith(monthKey)) {
                const dayRecords = workRecords[dateKey];
                let dayTotalMinutes = 0;

                dayRecords.forEach(record => {
                    if (record.end) {
                        dayTotalMinutes += Math.round((record.end - record.start) / (1000 * 60));
                    }
                });

                if (dayTotalMinutes > 0) {
                    monthWorkDays++;
                    monthTotalMinutes += dayTotalMinutes;
                }
            }
        });

        const monthEarnings = ((monthTotalMinutes / 60) * hourlyWage).toFixed(2);

        monthDaysEl.textContent = `${monthWorkDays} å¤©`;
        monthDurationEl.textContent = `${monthTotalMinutes} åˆ†é’Ÿ`;
        monthEarningsEl.textContent = `${monthEarnings} å…ƒ`;
    }

    // æœ¬æœˆæ‰“å¡è®°å½•åˆ—è¡¨
    function updateMonthRecordList() {
        monthRecordsListEl.innerHTML = '';

        function showEmpty(msg) {
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'record-empty';
            emptyDiv.textContent = msg;
            monthRecordsListEl.appendChild(emptyDiv);
        }

        const monthKey = getMonthKey();
        const allKeys = Object.keys(workRecords).sort();
        let hasRecord = false;

        allKeys.forEach(dateKey => {
            if (!dateKey.startsWith(monthKey)) return;

            const dayRecords = workRecords[dateKey];
            if (!dayRecords || dayRecords.length === 0) return;

            hasRecord = true;

            // æ—¥æœŸæ ‡é¢˜
            const header = document.createElement('div');
            header.className = 'record-date-header';
            header.textContent = `ğŸ“… ${dateKey}`;
            monthRecordsListEl.appendChild(header);

            // è¿™ä¸€å¤©çš„æ¯æ¡è®°å½•
            dayRecords.forEach((record, index) => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';

                const startTime = new Date(record.start);
                const startTimeStr = startTime.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                let mainHtml = '';
                if (record.end) {
                    const endTime = new Date(record.end);
                    const endTimeStr = endTime.toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    const duration = Math.round((record.end - record.start) / (1000 * 60));
                    const earnings = ((duration / 60) * hourlyWage).toFixed(2);

                    mainHtml = `
                        <div class="record-time">${startTimeStr} - ${endTimeStr}</div>
                        <div class="record-duration">${duration} åˆ†é’Ÿï¼ˆçº¦ ${earnings} å…ƒï¼‰</div>
                    `;
                } else {
                    mainHtml = `
                        <div class="record-time">${startTimeStr} - è¿›è¡Œä¸­â€¦</div>
                        <div class="record-duration">ç­‰å¾…ä¸‹ç­æ—¶é—´</div>
                    `;
                }

                recordItem.innerHTML = mainHtml;

                const delBtn = document.createElement('button');
                delBtn.textContent = 'åˆ é™¤';
                delBtn.className = 'record-delete-btn';
                delBtn.addEventListener('click', () => deleteRecord(dateKey, index));

                recordItem.appendChild(delBtn);
                monthRecordsListEl.appendChild(recordItem);
            });
        });

        if (!hasRecord) {
            showEmpty('æœ¬æœˆæš‚æ— æ‰“å¡è®°å½•');
        }
    }

    function updateDisplay() {
        updateSummaryView();
        updateRecordList();
        updateMonthStats();
        updateMonthRecordList();
    }

    // å¯¼å‡º Excel
    function exportMonthToExcel() {
        if (typeof XLSX === 'undefined') {
            alert('Excel å¯¼å‡ºåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚');
            return;
        }

        const monthKey = getMonthKey();
        const rows = [['æ—¥æœŸ', 'ä¸Šç­æ—¶é—´', 'ä¸‹ç­æ—¶é—´', 'æ—¶é•¿(åˆ†é’Ÿ)', 'æ”¶å…¥(å…ƒ)']];

        let totalMinutes = 0;
        let totalEarnings = 0;

        const allKeys = Object.keys(workRecords).sort();

        allKeys.forEach(dateKey => {
            if (!dateKey.startsWith(monthKey)) return;
            const records = workRecords[dateKey];

            records.forEach(record => {
                if (!record.end) return;

                const start = new Date(record.start);
                const end = new Date(record.end);
                const duration = Math.round((record.end - record.start) / (1000 * 60));
                const earnings = (duration / 60 * hourlyWage);

                totalMinutes += duration;
                totalEarnings += earnings;

                rows.push([
                    dateKey,
                    start.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'}),
                    end.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'}),
                    duration,
                    earnings.toFixed(2)
                ]);
            });
        });

        if (rows.length === 1) {
            alert('æœ¬æœˆæš‚æ— å®Œæˆçš„æ‰“å¡è®°å½•å¯å¯¼å‡ºã€‚');
            return;
        }

        rows.push([]);
        rows.push(['åˆè®¡', '', '', totalMinutes, totalEarnings.toFixed(2)]);

        const ws = XLSX.utils.aoa_to_sheet(rows);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'æœ¬æœˆè®°å½•');
        XLSX.writeFile(wb, `${monthKey}-æ‰“å·¥è®°å½•.xlsx`);
    }

    exportMonthBtn.addEventListener('click', exportMonthToExcel);

    // åˆæ¬¡æ¸²æŸ“
    updateDisplay();

    // PWA Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('service-worker.js').catch(err => {
                console.log('ServiceWorker æ³¨å†Œå¤±è´¥ï¼š', err);
            });
        });
    }
</script>
</body>
</html>
